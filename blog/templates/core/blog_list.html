{% extends "core/base.html" %}

{% load static %}

{% block bodycontent %}

{% load pagination_tags %}

<main id="main">
    <section>
        <div class="container" data-aos="fade-up">
            <div class="post-meta">
                <h6>Welcome {{user.first_name}} {{user.last_name}}</h6>
            </div>
            <div class="col-lg-12 text-center mb-5">

                <h1 class="page-title">My blogs</h1>


            </div>
            <div class="col-lg-12">
                <div class="row">
                    <div class="col-lg-9">
                        {% for blog in blogs %}
                        <div class="row py-4">
                            <div class="col-lg-6">
                                <div class="post-meta"><span>Blog ID: {{blog.id}}</span> <span
                                        class="mx-1">&bullet;</span><span class="date">Category:
                                        {{blog.get_blog_category_display}}</span>
                                    <span class="mx-1">&bullet;</span>
                                    <span>{{blog.created_on}}</span>
                                </div>
                                {% if blog.image%}
                                <div class="d-md-flex post-entry-2 half">
                                    <a href="{% url 'blog_details' blog.id %}" class="me-4 thumbnail">
                                        <img src="{{blog.image.url}}" alt="" class="img-fluid">
                                    </a>
                                </div>
                                {%endif%}
                            </div>
                            <div class="col-lg-6">
                                <h3><a href="{% url 'blog_details' blog.id %}">{{blog.title}}</a></h3>
                                <p>{{blog.description|truncatewords:30}}...</p>

                                <div>
                                    <a type="button" class="btn btn-success" href="{% url 'blog_details' blog.id %}"><i
                                            class="far fa-eye"></i></a>
                                    <a type="button" class="btn btn-success"
                                        href="{% url 'my_blog_update' blog.id %}"><i class="fas fa-edit"></i></a>
                                    <a type="button" class="btn btn-danger"
                                        href="{% url 'my_blog_delete' blog.id  %}"><i class="far fa-trash-alt"></i></a>
                                </div>

                            </div>

                        </div>
                        {%endfor%}
                    </div>

                    <div class="col-lg-3 border-start custom-border">
                        <div class="text-center ">
                            <h4>Filters</h4>
                            <br>

                            <form action="" method="get">
                                {% csrf_token %}
                                <div class="filter-field ">
                                    <h6>Filter blogs by categories:</h6>
                                    {{ filter.form.blog_category.lable_tag }} {{filter.form.blog_category}}
                                </div>
                                <br>
                                <div class="filter-field">
                                    <h6>Sort blogs by:</h6>
                                    {{ filter.form.sort_by.lable_tag }} {{filter.form.sort_by}}
                                </div>
                                <br>
                                <div class="filter-field">
                                    <h6>Search in titles or descriptions:</h6>
                                    {{ filter.form.search.lable_tag }} {{filter.form.search}}
                                </div>
                                <br>
                                <button type="submit" class="btn btn-primary">Submit</button>
                            </form>

                        </div>
                    </div>
                </div>
            </div>



        </div>


        {% if is_paginated %}
        <nav aria-label="Page navigation example" class="d-flex justify-content-center pt-3">
            <ul class="pagination">
                {% if page_obj.has_previous and page_obj.number != 2 %}
                <li class="page-item"><a class="page-link text-dark" href="?{% url_replace request 'page' 1 %}"
                        tabindex="-1" aria-disabled="true">First Page</a></li>
                {% endif %}
                {% if page_obj.has_previous %}
                <li class="page-item"><a class="page-link text-dark"
                        href="?{% url_replace request 'page' page_obj.previous_page_number %}">
                        {{ page_obj.previous_page_number}}
                    </a></li>
                {% endif %}
                <li class="page-item disabled"><a class="page-link" href="#">{{ page_obj.number }}</a></li>
                {% if page_obj.has_next %}
                <li class="page-item"><a class="page-link text-dark"
                        href="?{% url_replace request 'page' page_obj.next_page_number %}">
                        {{ page_obj.next_page_number }}
                    </a>
                </li>
                {% endif %}
                {% if page_obj.paginator.num_pages != page_obj.number %}
                <li class="page-item"><a class="page-link text-dark"
                        href="?{% url_replace request 'page' page_obj.paginator.num_pages %}">Last Page</a></li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}

        <label for="blogs_per_page">Blogs Per Page:</label>
        <select name="blogs_per_page" id="blogs_per_page">
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
        </select>

    </section>
</main>
<script>
    // Attach an event listener to the select element
    document.getElementById('blogs_per_page').addEventListener('change', function () {
        // Get the selected value
        var selectedValue = this.value;

        // Build the new URL with the updated query parameter
        var newUrl = updateQueryStringParameter(window.location.pathname, 'blogs_per_page', selectedValue);

        // Redirect to the new URL
        window.location.href = newUrl + window.location.search + window.location.hash;
    });

    // Function to update query string parameter
    function updateQueryStringParameter(uri, key, value) {
        var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
        var separator = uri.indexOf('?') !== -1 ? "&" : "?";
        if (uri.match(re)) {
            return uri.replace(re, '$1' + key + "=" + value + '$2');
        } else {
            return uri + separator + key + "=" + value;
        }
    }
</script>

{% endblock %}